# SCRIPT FOR TRANSFORMING DATA EXTRACTED BY THE NSF_extract_CCOA.r SCRIPT FOR SUBSEQUENT USE BY THE NSF_write.r SCRIPT #################################
## Make sure that the "fy" value specified below matches the fiscal year of interest.================================
## Make sure to update the customizations in the script (to eliminate any residual negative values, etc.).================================

# LOAD PACKAGES, SET WORKING DIRECTORY, SET FISCAL YEAR VECTOR #################################
#
library(tidyverse)
library("readr")
library("readxl")
#setwd("C:/Users/rchan/Box/IRAP Shared/Data Usage and Reporting/Research/NSF/FY2024/")

#Initialize the main input Data tibble (with a count of the rows) with a column listing all locations.
#
inputData <- transmute(expenditures, location) %>% distinct() %>% arrange(location)
inputDataCount <- length(inputData$location)

#Load the personnel data
personnel <- read_excel("Data/FY2024_researchers.xlsx", sheet = "FY2024_researchers") %>% as_tibble()

##Add columns for answering individual questions to inputData tibble.
##
#q1
#
inputData <- left_join(inputData, (filter(expenditures, federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q1FED = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, funding_source_category == 'STATE/LOCAL') %>% group_by(location) %>% summarize(q1STLOC = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, funding_source_category == 'BUSINESS') %>% group_by(location) %>% summarize(q1BUSINESS = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, funding_source_category == 'NONPROFIT') %>% group_by(location) %>% summarize(q1NONPROFIT = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, funding_source_category == 'INSTITUTIONAL') %>% group_by(location) %>% summarize(q1INST = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- mutate(inputData, q1COSTSHARE = 'Unavailable')
inputData <- left_join(inputData, (group_by(expenditures, location) %>% summarize(q1UNRECOV = round(mean(unrecovered_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, funding_source_category == 'OTHER') %>% group_by(location) %>% summarize(q1OTHER = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- mutate(inputData, q1COMMENT = 'Cost sharing data (question 1e2) is unavailable. We are unable to segregate this item from institutionally-financed research (reported in question 1e1).')
inputData <- left_join(inputData, (group_by(expenditures, location) %>% summarize(REIMBURSEMENTS = round(mean(reimbursement)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- replace(inputData,is.na(inputData),0)
inputData <- mutate(inputData, TOTAL = (q1FED + q1STLOC + q1BUSINESS + q1NONPROFIT + q1INST + q1UNRECOV + q1OTHER))

#q1.1
#
inputData <- mutate(inputData, q1.1aINCLUSIONS = 'Yes')
inputData <- mutate(inputData, q1.1bINCLUSIONS = 'Yes')
inputData <- mutate(inputData, q1.1cINCLUSIONS = 'Yes')
inputData <- mutate(inputData, q1.1dINCLUSIONS = 'Yes')

#q2
#
inputData <- left_join(inputData, (filter(expenditures, funding_source == 'GOVERNMENT_FOREIGN') %>% group_by(location) %>% summarize(q2ForeignGov = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, funding_source == 'BUSINESS_FOREIGN') %>% group_by(location) %>% summarize(q2Business = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, funding_source == 'NONPROFIT_FOREIGN') %>% group_by(location) %>% summarize(q2Nonprofit = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, funding_source == 'HIGHER_EDUCATION_FOREIGN') %>% group_by(location) %>% summarize(q2HigherEd = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, funding_source == 'OTHER_FOREIGN') %>% group_by(location) %>% summarize(q2Other = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')

#q3
#
inputData <- left_join(inputData, (filter(expenditures, nsf_award_type == 'CONTRACTS' ) %>% group_by(location) %>% summarize(q3CONTRACTS = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
#inputData <- mutate_all(inputData, ~replace_na(.,0))
inputData <- mutate(inputData, q3GRANTS = (TOTAL - q1INST - q1UNRECOV - q3CONTRACTS))

#q4
#
inputData <- left_join(inputData, (filter(expenditures, med_school == 'Y') %>% group_by(location) %>% summarize(q4Med = round(mean(total_amount)*n()/1000), q4TOT_COST = round(mean(total_amount)*n()/1000), .groups = 'keep')), by = 'location') %>% mutate(q4Med = ifelse(is.na(q4Med), 'No - Go to Question 5', 'Yes - Go to Question 4B'))

#q5
#
inputData <- left_join(inputData, (filter(expenditures, clinical_trial == 'Y' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q5FED = round(mean(total_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, clinical_trial == 'Y' & federal_sponsorship == '') %>% group_by(location) %>% summarize(q5NONFED = round(mean(total_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- mutate(inputData, q5Trial = ifelse((is.na(q5FED) & is.na(q5NONFED )), 'No - Go to Question 6', 'Yes - Go to Question 5B'))

#q6
#
inputData <- left_join(inputData, (filter(expenditures_projects, federal_sponsorship == 'Y' & project_category == 'BASIC') %>% group_by(location) %>% summarize(q6FEDBasic = round(mean(total_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_projects, federal_sponsorship == 'Y' & project_category == 'APPLIED') %>% group_by(location) %>% summarize(q6FEDApplied = round(mean(total_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- replace(inputData, is.na(inputData),0)
inputData <- mutate(inputData, q6FEDDevelopment = (q1FED - q6FEDBasic - q6FEDApplied))
inputData <- left_join(inputData, (filter(expenditures_projects, federal_sponsorship == '' & project_category == 'BASIC') %>% group_by(location) %>% summarize(q6NONFEDBasic = round(mean(total_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_projects, federal_sponsorship == '' & project_category == 'APPLIED') %>% group_by(location) %>% summarize(q6NONFEDApplied = round(mean(total_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- replace(inputData, is.na(inputData),0)
inputData <- mutate(inputData, q6NONFEDDevelopment = (TOTAL - q1FED - q6NONFEDBasic - q6NONFEDApplied))

#q7
#
inputData <- left_join(inputData, (filter(expenditures, pass_through_entity == 'HIGHER EDUCATION' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q7FEDHIGHERED = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, pass_through_entity == 'BUSINESS' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q7FEDBUSINESS = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, pass_through_entity == 'NONPROFIT' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q7FEDNONPROFIT = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, pass_through_entity == 'OTHER' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q7FEDOTHER = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, pass_through_entity == 'HIGHER EDUCATION' & pass_through_flag=='Y' & federal_sponsorship == '') %>% group_by(location) %>% summarize(q7NONFEDHIGHERED = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, pass_through_entity == 'BUSINESS' & pass_through_flag=='Y'  & federal_sponsorship == '') %>% group_by(location) %>% summarize(q7NONFEDBUSINESS = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, pass_through_entity == 'NONPROFIT' & pass_through_flag=='Y'  & federal_sponsorship == '') %>% group_by(location) %>% summarize(q7NONFEDNONPROFIT = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, pass_through_entity == 'OTHER' & pass_through_flag=='Y' & federal_sponsorship == '') %>% group_by(location) %>% summarize(q7NONFEDOTHER = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')

#q8
#
inputData <- mutate(inputData, q8FEDHigherEd = 'Unavailable', q8FEDBusiness = 'Unavailable', q8FEDNonprofit = 'Unavailable' )
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'PASS_THROUGHS' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q8FEDOTHER = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- mutate(inputData, q8NONFEDHigherEd = 'Unavailable', q8NONFEDBusiness = 'Unavailable', q8NONFEDNonprofit = 'Unavailable' )
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'PASS_THROUGHS' & federal_sponsorship == '') %>% group_by(location) %>% summarize(q8NONFEDOTHER = round(mean(funded_amount)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- mutate(inputData, q8Comment = 'The University of California is unable to provide information as to the category of subrecipient. This campus did not provide data indicating the type of organization it provides passes through awards to.')
#inputData <- mutate_all(inputData, ~replace_na(.,0))
inputData <- replace(inputData,is.na(inputData),0)
inputData <- mutate(inputData, PASSTHROUGHS = (q8FEDOTHER + q8NONFEDOTHER))

#q9
#
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q9A1USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q9A1DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q9A1DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q9A1HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q9A1NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q9A1NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q9A1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q9B1USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q9B1DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q9B1DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q9B1HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q9B1NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q9B1NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q9B1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q9B2USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q9B2DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q9B2DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q9B2HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q9B2NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q9B2NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q9B2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q9B3USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q9B3DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q9B3DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q9B3HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q9B3NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q9B3NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q9B3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q9B4USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q9B4DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q9B4DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q9B4HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q9B4NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q9B4NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q9B4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q9B5USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q9B5DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q9B5DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q9B5HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q9B5NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q9B5NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q9B5OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q9B6USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q9B6DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q9B6DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q9B6HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q9B6NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q9B6NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q9B6OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q9B7USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q9B7DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q9B7DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q9B7HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q9B7NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q9B7NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q9B7OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q9B8USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q9B8DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q9B8DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q9B8HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q9B8NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q9B8NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q9B8OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q9B9USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q9B9DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q9B9DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q9B9HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q9B9NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q9B9NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q9B9OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q9C1USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q9C1DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q9C1DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q9C1HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q9C1NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q9C1NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q9C1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q9C2USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q9C2DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q9C2DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q9C2HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q9C2NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q9C2NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q9C2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q9C3USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q9C3DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q9C3DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q9C3HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q9C3NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q9C3NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q9C3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q9C4USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q9C4DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q9C4DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q9C4HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q9C4NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q9C4NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q9C4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q9D1USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q9D1DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q9D1DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q9D1HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q9D1NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q9D1NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q9D1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q9D2USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q9D2DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q9D2DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q9D2HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q9D2NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q9D2NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q9D2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q9D3USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q9D3DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q9D3DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q9D3HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q9D3NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q9D3NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q9D3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q9D4USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q9D4DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q9D4DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q9D4HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q9D4NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q9D4NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q9D4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q9D5USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q9D5DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q9D5DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q9D5HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q9D5NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q9D5NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q9D5OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q9E1USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q9E1DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q9E1DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q9E1HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q9E1NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q9E1NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q9E1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q9F1USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q9F1DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q9F1DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q9F1HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q9F1NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q9F1NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q9F1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q9F2USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q9F2DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q9F2DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q9F2HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q9F2NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q9F2NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q9F2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q9F3USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q9F3DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q9F3DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q9F3HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q9F3NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q9F3NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q9F3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q9F4USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q9F4DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q9F4DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q9F4HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q9F4NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q9F4NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q9F4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q9F5USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q9F5DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q9F5DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q9F5HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q9F5NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q9F5NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q9F5OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q9G1USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q9G1DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q9G1DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q9G1HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q9G1NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q9G1NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q9G1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q9H1USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q9H1DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q9H1DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q9H1HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q9H1NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q9H1NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q9H1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q9H2USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q9H2DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q9H2DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q9H2HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q9H2NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q9H2NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q9H2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q9H3USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q9H3DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q9H3DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q9H3HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q9H3NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q9H3NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q9H3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q9H4USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q9H4DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q9H4DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q9H4HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q9H4NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q9H4NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q9H4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q9H5USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q9H5DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q9H5DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q9H5HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q9H5NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q9H5NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q9H5OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q9I1USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q9I1DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q9I1DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q9I1HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q9I1NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q9I1NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q9I1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q9J1USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q9J1DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q9J1DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q9J1HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q9J1NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q9J1NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q9J1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q9J2USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q9J2DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q9J2DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q9J2HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q9J2NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q9J2NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q9J2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q9J3USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q9J3DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q9J3DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q9J3HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q9J3NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q9J3NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q9J3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q9J4USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q9J4DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q9J4DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q9J4HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q9J4NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q9J4NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q9J4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q9J5USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q9J5DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q9J5DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q9J5HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q9J5NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q9J5NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q9J5OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q9J6USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q9J6DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q9J6DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q9J6HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q9J6NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q9J6NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q9J6OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q9J7USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q9J7DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q9J7DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q9J7HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q9J7NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q9J7NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q9J7OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_USDA' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q9J8USDA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOD' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q9J8DOD = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_DOE' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q9J8DOE = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_HHS' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q9J8HHS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NASA' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q9J8NASA = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_NSF' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q9J8NSF = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'FEDERAL_OTHER' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q9J8OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')

#q10
#
inputData <- left_join(inputData, (group_by(expenditures_summary2, location) %>% mutate(RANK = min_rank(desc(amount))) %>% filter(RANK == 1) %>% transmute(q10AGENCYa = ifelse(round(amount/1000) > 0, funding_source, ''), q10AMOUNTa = ifelse(round(amount/1000) > 0, round(amount/1000), 0))), by = 'location')
inputData <- left_join(inputData, (group_by(expenditures_summary2, location) %>% mutate(RANK = min_rank(desc(amount))) %>% filter(RANK == 2) %>% transmute(q10AGENCYb = ifelse(round(amount/1000) > 0, funding_source, ''), q10AMOUNTb = ifelse(round(amount/1000) > 0, round(amount/1000), 0))), by = 'location')
inputData <- left_join(inputData, (group_by(expenditures_summary2, location) %>% mutate(RANK = min_rank(desc(amount))) %>% filter(RANK == 3) %>% transmute(q10AGENCYc = ifelse(round(amount/1000) > 0, funding_source, ''), q10AMOUNTc = ifelse(round(amount/1000) > 0, round(amount/1000), 0))), by = 'location')
inputData <- left_join(inputData, (group_by(expenditures_summary2, location) %>% mutate(RANK = min_rank(desc(amount))) %>% filter(RANK == 4) %>% transmute(q10AGENCYd = ifelse(round(amount/1000) > 0, funding_source, ''), q10AMOUNTd = ifelse(round(amount/1000) > 0, round(amount/1000), 0))), by = 'location')
inputData <- left_join(inputData, (group_by(expenditures_summary2, location) %>% mutate(RANK = min_rank(desc(amount))) %>% filter(RANK == 5) %>% transmute(q10AGENCYe = ifelse(round(amount/1000) > 0, funding_source, ''), q10AMOUNTe = ifelse(round(amount/1000) > 0, round(amount/1000), 0))), by = 'location')
inputData <- left_join(inputData, (group_by(expenditures_summary2, location) %>% mutate(RANK = min_rank(desc(amount))) %>% filter(RANK == 6) %>% transmute(q10AGENCYf = ifelse(round(amount/1000) > 0, funding_source, ''), q10AMOUNTf = ifelse(round(amount/1000) > 0, round(amount/1000), 0))), by = 'location')
inputData <- left_join(inputData, (group_by(expenditures_summary2, location) %>% mutate(RANK = min_rank(desc(amount))) %>% filter(RANK == 7) %>% transmute(q10AGENCYg = ifelse(round(amount/1000) > 0, funding_source, ''), q10AMOUNTg = ifelse(round(amount/1000) > 0, round(amount/1000), 0))), by = 'location')
inputData <- left_join(inputData, (group_by(expenditures_summary2, location) %>% mutate(RANK = min_rank(desc(amount))) %>% filter(RANK == 8) %>% transmute(q10AGENCYh = ifelse(round(amount/1000) > 0, funding_source, ''), q10AMOUNTh = ifelse(round(amount/1000) > 0, round(amount/1000), 0))), by = 'location')
inputData <- left_join(inputData, (group_by(expenditures_summary2, location) %>% mutate(RANK = min_rank(desc(amount))) %>% filter(RANK == 9) %>% transmute(q10AGENCYi = ifelse(round(amount/1000) > 0, funding_source, ''), q10AMOUNTi = ifelse(round(amount/1000) > 0, round(amount/1000), 0))), by = 'location')
inputData <- left_join(inputData, (group_by(expenditures_summary2, location) %>% mutate(RANK = min_rank(desc(amount))) %>% filter(RANK == 10) %>% transmute(q10AGENCYj = ifelse(round(amount/1000) > 0, funding_source, ''), q10AMOUNTj = ifelse(round(amount/1000) > 0, round(amount/1000), 0))), by = 'location')

##Additional  Processing of responses in inputData table to prepare for calculation of q10residual.
##
#Convert all NA character values to blanks.
#
inputData <- mutate(inputData, q10AGENCYa = ifelse(is.na(q10AGENCYa), '', q10AGENCYa), q10AGENCYb = ifelse(is.na(q10AGENCYb), '', q10AGENCYb), q10AGENCYc = ifelse(is.na(q10AGENCYc), '', q10AGENCYc), q10AGENCYd = ifelse(is.na(q10AGENCYd), '', q10AGENCYd), q10AGENCYe = ifelse(is.na(q10AGENCYe), '', q10AGENCYe), q10AGENCYf = ifelse(is.na(q10AGENCYf), '', q10AGENCYf), q10AGENCYg = ifelse(is.na(q10AGENCYg), '', q10AGENCYg), q10AGENCYh = ifelse(is.na(q10AGENCYh), '', q10AGENCYh), q10AGENCYi = ifelse(is.na(q10AGENCYi), '', q10AGENCYi), q10AGENCYj = ifelse(is.na(q10AGENCYj), '', q10AGENCYj))

#Convert all numerical NA values to zero.
#
#inputData <- mutate_all(inputData, ~replace_na(.,0)) # this was commented out but we'll need it to do the following calc - that said it gives an error, use next line instead
inputData <- replace(inputData,is.na(inputData),0)

#Calculate q10residual.
#
inputData <- mutate(inputData, q10residual = (q9A1OTHER + q9B1OTHER + q9B2OTHER + q9B3OTHER + q9B4OTHER + q9B5OTHER + q9B6OTHER + q9B7OTHER + q9B8OTHER + q9B9OTHER + q9C1OTHER + q9C2OTHER + q9C3OTHER + q9C4OTHER + q9D1OTHER + q9D2OTHER + q9D3OTHER + q9D4OTHER + q9D5OTHER + q9E1OTHER + q9F1OTHER + q9F2OTHER + q9F3OTHER + q9F4OTHER + q9F5OTHER + q9G1OTHER + q9H1OTHER + q9H2OTHER + q9H3OTHER + q9H4OTHER + q9H5OTHER + q9I1OTHER + q9J1OTHER + q9J2OTHER + q9J3OTHER + q9J4OTHER + q9J5OTHER + q9J6OTHER + q9J7OTHER + q9J8OTHER - q10AMOUNTa - q10AMOUNTb - q10AMOUNTc - q10AMOUNTd - q10AMOUNTe - q10AMOUNTf - q10AMOUNTg - q10AMOUNTh - q10AMOUNTi - q10AMOUNTj))

#q11
#
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q11A1STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q11A1BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q11A1NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q11A1INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'A1-Computer Sciences' ) %>% group_by(location) %>% summarize(q11A1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q11B1STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q11B1BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q11B1NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q11B1INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' ) %>% group_by(location) %>% summarize(q11B1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q11B2STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q11B2BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q11B2NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q11B2INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' ) %>% group_by(location) %>% summarize(q11B2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q11B3STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q11B3BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q11B3NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q11B3INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'B3-Engineering: Chemical' ) %>% group_by(location) %>% summarize(q11B3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q11B4STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q11B4BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q11B4NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q11B4INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'B4-Engineering: Civil' ) %>% group_by(location) %>% summarize(q11B4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q11B5STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q11B5BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q11B5NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q11B5INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'B5-Engineering: Electrical' ) %>% group_by(location) %>% summarize(q11B5OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q11B6STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q11B6BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q11B6NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q11B6INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' ) %>% group_by(location) %>% summarize(q11B6OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q11B7STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q11B7BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q11B7NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q11B7INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'B7-Engineering: Mechanical' ) %>% group_by(location) %>% summarize(q11B7OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q11B8STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q11B8BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q11B8NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q11B8INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'B8-Engineering: Metals & Materials' ) %>% group_by(location) %>% summarize(q11B8OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q11B9STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q11B9BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q11B9NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q11B9INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'B9-Engineering: Other' ) %>% group_by(location) %>% summarize(q11B9OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q11C1STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q11C1BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q11C1NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q11C1INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' ) %>% group_by(location) %>% summarize(q11C1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q11C2STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q11C2BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q11C2NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q11C2INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' ) %>% group_by(location) %>% summarize(q11C2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q11C3STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q11C3BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q11C3NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q11C3INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' ) %>% group_by(location) %>% summarize(q11C3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q11C4STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q11C4BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q11C4NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q11C4INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'C4-Environmental Sciences: Other' ) %>% group_by(location) %>% summarize(q11C4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q11D1STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q11D1BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q11D1NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q11D1INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'D1-Life Sciences: Agricultural' ) %>% group_by(location) %>% summarize(q11D1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q11D2STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q11D2BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q11D2NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q11D2INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'D2-Life Sciences: Biological' ) %>% group_by(location) %>% summarize(q11D2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q11D3STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q11D3BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q11D3NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q11D3INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'D3-Life Sciences: Medical' ) %>% group_by(location) %>% summarize(q11D3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q11D4STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q11D4BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q11D4NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q11D4INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' ) %>% group_by(location) %>% summarize(q11D4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q11D5STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q11D5BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q11D5NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q11D5INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'D5-Life Sciences: Other' ) %>% group_by(location) %>% summarize(q11D5OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q11E1STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q11E1BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q11E1NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q11E1INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'E1-Mathematical Sciences' ) %>% group_by(location) %>% summarize(q11E1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q11F1STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q11F1BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q11F1NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q11F1INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'F1-Physical Sciences: Astronomy' ) %>% group_by(location) %>% summarize(q11F1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q11F2STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q11F2BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q11F2NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q11F2INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'F2-Physical Sciences: Chemistry' ) %>% group_by(location) %>% summarize(q11F2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q11F3STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q11F3BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q11F3NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q11F3INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' ) %>% group_by(location) %>% summarize(q11F3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q11F4STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q11F4BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q11F4NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q11F4INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'F4-Physical Sciences: Physics' ) %>% group_by(location) %>% summarize(q11F4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q11F5STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q11F5BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q11F5NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q11F5INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'F5-Physical Sciences: Other' ) %>% group_by(location) %>% summarize(q11F5OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q11G1STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q11G1BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q11G1NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q11G1INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'G1-Psychology' ) %>% group_by(location) %>% summarize(q11G1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q11H1STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q11H1BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q11H1NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q11H1INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'H1-Social Sciences: Anthropology' ) %>% group_by(location) %>% summarize(q11H1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q11H2STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q11H2BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q11H2NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q11H2INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'H2-Social Sciences: Economics' ) %>% group_by(location) %>% summarize(q11H2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q11H3STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q11H3BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q11H3NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q11H3INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'H3-Social Sciences: Political Science' ) %>% group_by(location) %>% summarize(q11H3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q11H4STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q11H4BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q11H4NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q11H4INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'H4-Social Sciences: Sociology' ) %>% group_by(location) %>% summarize(q11H4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q11H5STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q11H5BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q11H5NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q11H5INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'H5-Social Sciences: Other' ) %>% group_by(location) %>% summarize(q11H5OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q11I1STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q11I1BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q11I1NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q11I1INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'I1-Other Sciences' ) %>% group_by(location) %>% summarize(q11I1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q11J1STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q11J1BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q11J1NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q11J1INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'J1-Business and Management' ) %>% group_by(location) %>% summarize(q11J1OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q11J2STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q11J2BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q11J2NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q11J2INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'J2-Communications, Journalism and Library Science' ) %>% group_by(location) %>% summarize(q11J2OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q11J3STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q11J3BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q11J3NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q11J3INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'J3-Education' ) %>% group_by(location) %>% summarize(q11J3OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q11J4STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q11J4BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q11J4NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q11J4INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'J4-Humanities' ) %>% group_by(location) %>% summarize(q11J4OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q11J5STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q11J5BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q11J5NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q11J5INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'J5-Law' ) %>% group_by(location) %>% summarize(q11J5OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q11J6STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q11J6BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q11J6NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q11J6INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'J6-Social Work' ) %>% group_by(location) %>% summarize(q11J6OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q11J7STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q11J7BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q11J7NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q11J7INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'J7-Visual & Performing Arts' ) %>% group_by(location) %>% summarize(q11J7OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'STATE/LOCAL' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q11J8STLOC = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'BUSINESS' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q11J8BUSINESS = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'NONPROFIT' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q11J8NONPROFIT = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'INSTITUTIONAL' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q11J8INST = mean(amount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures_summary, funding_source_category == 'OTHER' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' ) %>% group_by(location) %>% summarize(q11J8OTHER = mean(amount)*n(), .groups = 'keep')), by = 'location')

#q12
#
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'LABOR') %>% group_by(location) %>% summarize(q12aWAGES = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- mutate(inputData, q12b1NONCAPSOFT = 0 )
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_SOFTWARE') %>% group_by(location) %>% summarize(q12b2CAPSOFT = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT') %>% group_by(location) %>% summarize(q12cTOTEQUIP = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- mutate(inputData, q12dPASSTHRU = PASSTHROUGHS)
#inputData <- mutate_all(inputData, ~replace_na(.,0))
inputData <- replace(inputData,is.na(inputData),0)
inputData <- mutate(inputData, q12eOTHERDIRECT = TOTAL - q12aWAGES - q12b1NONCAPSOFT - q12b2CAPSOFT - q12cTOTEQUIP - q12dPASSTHRU - REIMBURSEMENTS - q1UNRECOV)
inputData <- mutate(inputData, q12fACTUAL = REIMBURSEMENTS)
inputData <- mutate(inputData, q12fUNREIMBURSED = q1UNRECOV)
inputData <- mutate(inputData, q12Comment = ifelse(q12b2CAPSOFT == 0, 'This University of California campus is unable to separately report software purchases. 12b1 purchases are reported in 12e, while 12b2 purchases are reported in 12c.', 'This University of California campus is unable to separately report noncapitalized software purchases. 12b1 purchases are reported in 12e.'))

#q13
#
inputData <- mutate(inputData, q13Software = 5.0 )
inputData <- mutate(inputData, q13Equpiment = 5.0 )

#q14 
#
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'A1-Computer Sciences' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14A1FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'A1-Computer Sciences' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14A1NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14B1FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B1-Engineering: Aeronautical and Astronautical' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14B1NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14B2FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B2-Engineering: Bioeng/Biomed Engin' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14B2NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B3-Engineering: Chemical' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14B3FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B3-Engineering: Chemical' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14B3NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B4-Engineering: Civil' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14B4FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B4-Engineering: Civil' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14B4NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B5-Engineering: Electrical' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14B5FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B5-Engineering: Electrical' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14B5NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14B6FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B6-Engineering: Industrial & Manufacturing Engineering' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14B6NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B7-Engineering: Mechanical' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14B7FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B7-Engineering: Mechanical' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14B7NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B8-Engineering: Metals & Materials' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14B8FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B8-Engineering: Metals & Materials' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14B8NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B9-Engineering: Other' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14B9FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'B9-Engineering: Other' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14B9NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14C1FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'C1-Environmental Sciences: Atmospheric' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14C1NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14C2FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'C2-Environmental Sciences: Earth Sciences' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14C2NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14C3FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'C3-Environmental Sciences: Oceanography' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14C3NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'C4-Environmental Sciences: Other' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14C4FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'C4-Environmental Sciences: Other' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14C4NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'D1-Life Sciences: Agricultural' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14D1FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'D1-Life Sciences: Agricultural' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14D1NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'D2-Life Sciences: Biological' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14D2FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'D2-Life Sciences: Biological' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14D2NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'D3-Life Sciences: Medical' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14D3FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'D3-Life Sciences: Medical' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14D3NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14D4FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'D4-Life Sciences: Natural Resources & Conservation' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14D4NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'D5-Life Sciences: Other' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14D5FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'D5-Life Sciences: Other' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14D5NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'E1-Mathematical Sciences' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14E1FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'E1-Mathematical Sciences' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14E1NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'F1-Physical Sciences: Astronomy' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14F1FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'F1-Physical Sciences: Astronomy' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14F1NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'F2-Physical Sciences: Chemistry' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14F2FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'F2-Physical Sciences: Chemistry' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14F2NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14F3FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'F3-Physical Sciences: Material Sciences' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14F3NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'F4-Physical Sciences: Physics' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14F4FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'F4-Physical Sciences: Physics' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14F4NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'F5-Physical Sciences: Other' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14F5FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'F5-Physical Sciences: Other' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14F5NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'G1-Psychology' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14G1FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'G1-Psychology' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14G1NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'H1-Social Sciences: Anthropology' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14H1FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'H1-Social Sciences: Anthropology' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14H1NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'H2-Social Sciences: Economics' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14H2FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'H2-Social Sciences: Economics' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14H2NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'H3-Social Sciences: Political Science' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14H3FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'H3-Social Sciences: Political Science' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14H3NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'H4-Social Sciences: Sociology' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14H4FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'H4-Social Sciences: Sociology' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14H4NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'H5-Social Sciences: Other' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14H5FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'H5-Social Sciences: Other' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14H5NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'I1-Other Sciences' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14I1FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'I1-Other Sciences' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14I1NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J1-Business and Management' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14J1FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J1-Business and Management' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14J1NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J2-Communications, Journalism and Library Science' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14J2FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J2-Communications, Journalism and Library Science' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14J2NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J3-Education' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14J3FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J3-Education' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14J3NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J4-Humanities' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14J4FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J4-Humanities' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14J4NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J5-Law' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14J5FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J5-Law' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14J5NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J6-Social Work' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14J6FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J6-Social Work' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14J6NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J7-Visual & Performing Arts' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14J7FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J7-Visual & Performing Arts' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14J7NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' & federal_sponsorship == 'Y') %>% group_by(location) %>% summarize(q14J8FED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(expenditures, nsf_cost_type== 'CAPITALIZED_EQUIPMENT' & nsf_discipline == 'J8-Other Non-Science & Engineering Fields' & federal_sponsorship != 'Y') %>% group_by(location) %>% summarize(q14J8NONFED = round(mean(direct)*n()/1000), .groups = 'keep')), by = 'location')
#inputData <- mutate_all(inputData, ~replace_na(.,0))
inputData <- replace(inputData,is.na(inputData),0)
inputData <- mutate(inputData, EQUIPMENT = (q14A1FED + q14A1NONFED + q14B1FED + q14B1NONFED + q14B2FED + q14B2NONFED + q14B3FED + q14B3NONFED + q14B4FED + q14B4NONFED + q14B5FED + q14B5NONFED + q14B6FED + q14B6NONFED + q14B7FED + q14B7NONFED + q14B8FED + q14B8NONFED + q14B9FED + q14B9NONFED + q14C1FED + q14C1NONFED + q14C2FED + q14C2NONFED + q14C3FED + q14C3NONFED + q14C4FED + q14C4NONFED + q14D1FED + q14D1NONFED + q14D2FED + q14D2NONFED + q14D3FED + q14D3NONFED + q14D4FED + q14D4NONFED + q14D5FED + q14D5NONFED + q14E1FED + q14E1NONFED + q14F1FED + q14F1NONFED + q14F2FED + q14F2NONFED + q14F3FED + q14F3NONFED + q14F4FED +  q14F4NONFED + q14F5FED + q14F5NONFED + q14G1FED + q14G1NONFED + q14H1FED + q14H1NONFED + q14H2FED + q14H2NONFED + q14H3FED + q14H3NONFED + q14H4FED + q14H4NONFED + q14H5FED + q14H5NONFED + q14I1FED + q14I1NONFED + q14J1FED + q14J1NONFED + q14J2FED + q14J2NONFED + q14J3FED + q14J3NONFED + q14J4FED + q14J4NONFED + q14J5FED + q14J5NONFED + q14J6FED + q14J6NONFED + q14J7FED + q14J7NONFED + q14J8FED + q14J8NONFED ))
inputData <- mutate(inputData,  q14I1FED = (q12cTOTEQUIP - EQUIPMENT + q14I1FED))
#q15
#
inputData <- left_join(inputData, (filter(personnel,category == 'RESEARCHERS') %>% group_by(location) %>% summarize(q15RESEARCHERS = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel,category == 'RD TECHNICIANS') %>% group_by(location) %>% summarize(q15TECHNICIANS = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel,category == 'RD SUPPORT STAFF') %>% group_by(location) %>% summarize(q15SUPPORT = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel,category == 'RESEARCHERS' & sex == 'Female') %>% group_by(location) %>% summarize(q15RESEARCHERSfemale = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel,category == 'RD TECHNICIANS' & sex == 'Female') %>% group_by(location) %>% summarize(q15TECHNICIANSfemale = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel,category == 'RD SUPPORT STAFF' & sex == 'Female') %>% group_by(location) %>% summarize(q15SUPPORTfemale = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel,category == 'RESEARCHERS' & sex == 'Male') %>% group_by(location) %>% summarize(q15RESEARCHERSmale = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel,category == 'RD TECHNICIANS' & sex == 'Male') %>% group_by(location) %>% summarize(q15TECHNICIANSmale = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel,category == 'RD SUPPORT STAFF' & sex == 'Male') %>% group_by(location) %>% summarize(q15SUPPORTmale = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel,category == 'RESEARCHERS' & sex == 'Not stated') %>% group_by(location) %>% summarize(q15RESEARCHERSSexUnknown = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel,category == 'RD TECHNICIANS' & sex == 'Not stated') %>% group_by(location) %>% summarize(q15TECHNICIANSSexUnknown = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel,category == 'RD SUPPORT STAFF' & sex == 'Not stated') %>% group_by(location) %>% summarize(q15SUPPORTSexUnknown = mean(headcount)*n(), .groups = 'keep')), by = 'location')
#inputData <- left_join(inputData, (filter(personnel, category == 'RESEARCHERS' & RESIDENCY == 'RESIDENT') %>% group_by(location) %>% summarize(q15RESEARCHERSusa = mean(headcount)*n(), .groups = 'keep')), by = 'location')
#inputData <- left_join(inputData, (filter(personnel, category == 'R&D TECHNICIANS' & RESIDENCY == 'RESIDENT') %>% group_by(location) %>% summarize(q15TECHNICIANSusa = mean(headcount)*n(), .groups = 'keep')), by = 'location')
#inputData <- left_join(inputData, (filter(personnel, category == 'R&D SUPPORT STAFF' & RESIDENCY == 'RESIDENT') %>% group_by(location) %>% summarize(q15SUPPORTusa = mean(headcount)*n(), .groups = 'keep')), by = 'location')
#inputData <- left_join(inputData, (filter(personnel, category == 'RESEARCHERS' & RESIDENCY == 'NON-RESIDENT') %>% group_by(location) %>% summarize(q15RESEARCHERSforeign = mean(headcount)*n(), .groups = 'keep')), by = 'location')
#inputData <- left_join(inputData, (filter(personnel, category == 'R&D TECHNICIANS' & RESIDENCY == 'NON-RESIDENT') %>% group_by(location) %>% summarize(q15TECHNICIANSforeign = mean(headcount)*n(), .groups = 'keep')), by = 'location')
#inputData <- left_join(inputData, (filter(personnel, category == 'R&D SUPPORT STAFF' & RESIDENCY == 'NON-RESIDENT') %>% group_by(location) %>% summarize(q15SUPPORTforeign = mean(headcount)*n(), .groups = 'keep')), by = 'location')

inputData <- mutate(inputData, q15RESEARCHERSusa = 'Unavailable')
inputData <- mutate(inputData, q15TECHNICIANSusa = 'Unavailable')
inputData <- mutate(inputData, q15SUPPORTusa = 'Unavailable')
inputData <- mutate(inputData, q15RESEARCHERSforeign = 'Unavailable')
inputData <- mutate(inputData, q15TECHNICIANSforeign = 'Unavailable')
inputData <- mutate(inputData, q15SUPPORTforeign = 'Unavailable')

inputData <- left_join(inputData, (filter(personnel, category == 'RESEARCHERS') %>% group_by(location) %>% summarize(q15RESEARCHERScitizenshipUnknown = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel, category == 'RD TECHNICIANS') %>% group_by(location) %>% summarize(q15TECHNICIANScitizenshipUnknown = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel, category == 'RD SUPPORT STAFF') %>% group_by(location) %>% summarize(q15SUPPORTcitizenshipUnknown = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- mutate(inputData, q15Doctorate = 'Unavailable')
inputData <- mutate(inputData, q15Professional = 'Unavailable')
inputData <- mutate(inputData, q15Masters = 'Unavailable')
inputData <- mutate(inputData, q15LessThanMasters= 'Unavailable')
inputData <- left_join(inputData, (filter(personnel, category == 'RESEARCHERS') %>% group_by(location) %>% summarize(q15EdUnknown = mean(headcount)*n(), .groups = 'keep')), by = 'location')
inputData <- mutate(inputData, q15COMMENT = ifelse(location == 'BERKELEY', 'Personnel data regarding education level (question 15D) are not available. All personnel are classified as unknown/unstated for  question 15D.','Personnel data regarding citizenship/residency status (question 15C) and education level (question 15D) are not available. All personnel are classified as unknown/unstated for  questions 15C and 15D.'))

#q16
#
inputData <- left_join(inputData, (filter(personnel, category == 'RESEARCHERS') %>% group_by(location) %>% summarize(q16ResearchersFTE = round(sum(fte), digits = 1), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel, category == 'RD TECHNICIANS') %>% group_by(location) %>% summarize(q16TechniciansFTE = round(sum(fte), digits = 1), .groups = 'keep')), by = 'location')
inputData <- left_join(inputData, (filter(personnel, category == 'RD SUPPORT STAFF') %>% group_by(location) %>% summarize(q16SupportFTE = round(sum(fte), digits = 1), .groups = 'keep')), by = 'location')
#inputData <- mutate_all(inputData, ~replace_na( . , 0))
inputData <- replace(inputData, is.na(inputData),0)
#q17
#
inputData <- mutate(inputData, q17FYMonth = 'June')


